name: RELEASE [PRODUCTION] - Create Release PR

on:
  pull_request_target:
    types: [closed]
    branches:
      - pre-release

permissions:
  contents: write
  pull-requests: write
  actions: read

jobs:
  create_release_pr:
    name: Create Release Pull Request
    runs-on: ubuntu-latest
    if: ${{ github.event.pull_request.merged == true }}

    steps:
      - name: Checkout pre-release Branch
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.base.ref }}
          fetch-depth: 0

      - name: Create Release PR
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          PRE_TITLE="${{ github.event.pull_request.title }}"
          PR_BODY="${{ github.event.pull_request.body }}"
          RELEASE_TITLE=$(echo "$PRE_TITLE" | sed 's/PRE-RELEASE/RELEASE/')

          gh pr create \
            --title "$RELEASE_TITLE" \
            --body "$PR_BODY" \
            --base main \
            --head pre-release \
            --label "release" \
            --assignee "${{ github.actor }}"

      - name: Notify Completion
        run: |
          echo "âœ… Release PR created successfully!"
          echo "ðŸ”— Check the PR in GitHub to review all changes."
          echo "ðŸš€ Next step: Merge the Release PR to main to trigger the tagging workflow."
