name: RELEASE [PRODUCTION] - Create Release PR

on:
  pull_request_target:
    types: [closed]

permissions:
  contents: write
  pull-requests: write
  actions: read

jobs:
  create_release_pr:
    name: Create Release Pull Request
    runs-on: ubuntu-latest
    if: ${{ github.event.pull_request.merged == true }} # Solo si el PR se cerrÃ³ y mergeÃ³
    steps:
      - name: Checkout pre-release Branch
        uses: actions/checkout@v4
        with:
          ref: pre-release
          fetch-depth: 0

      - name: Setup GitHub CLI
        uses: cli/cli-action@v3 # Para poder usar gh
        with:
          version: latest

      - name: Create Release PR
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Tomamos tÃ­tulo y body del PR cerrado
          PR_TITLE="${{ github.event.pull_request.title }}"
          PR_BODY="${{ github.event.pull_request.body }}"

          # Crear PR desde pre-release hacia main
          gh pr create \
            --title "$PR_TITLE" \
            --body "$PR_BODY" \
            --base main \
            --head pre-release \
            --label "release" \
            --assignee "${{ github.actor }}"

      - name: Notify Completion
        run: |
          echo "âœ… Release PR created successfully!"
          echo "ðŸ”— Check the PR in GitHub to review all changes."
